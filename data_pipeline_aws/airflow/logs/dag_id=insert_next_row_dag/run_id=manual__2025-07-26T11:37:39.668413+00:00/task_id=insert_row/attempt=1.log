[2025-07-26T11:37:40.367+0000] {local_task_job_runner.py:120} INFO - ::group::Pre task execution logs
[2025-07-26T11:37:40.377+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: insert_next_row_dag.insert_row manual__2025-07-26T11:37:39.668413+00:00 [queued]>
[2025-07-26T11:37:40.381+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: insert_next_row_dag.insert_row manual__2025-07-26T11:37:39.668413+00:00 [queued]>
[2025-07-26T11:37:40.381+0000] {taskinstance.py:2306} INFO - Starting attempt 1 of 1
[2025-07-26T11:37:40.386+0000] {taskinstance.py:2330} INFO - Executing <Task(PythonOperator): insert_row> on 2025-07-26 11:37:39.668413+00:00
[2025-07-26T11:37:40.390+0000] {logging_mixin.py:188} WARNING - /home/***/.local/lib/python3.12/site-packages/***/task/task_runner/standard_task_runner.py:62 DeprecationWarning: This process (pid=24976) is multi-threaded, use of fork() may lead to deadlocks in the child.
[2025-07-26T11:37:40.390+0000] {standard_task_runner.py:64} INFO - Started process 25001 to run task
[2025-07-26T11:37:40.390+0000] {standard_task_runner.py:90} INFO - Running: ['***', 'tasks', 'run', 'insert_next_row_dag', 'insert_row', 'manual__2025-07-26T11:37:39.668413+00:00', '--job-id', '38', '--raw', '--subdir', 'DAGS_FOLDER/simulate_realtime_insert.py', '--cfg-path', '/tmp/tmpwcmri7n3']
[2025-07-26T11:37:40.392+0000] {standard_task_runner.py:91} INFO - Job 38: Subtask insert_row
[2025-07-26T11:37:40.399+0000] {logging_mixin.py:188} WARNING - /home/***/.local/lib/python3.12/site-packages/***/settings.py:195 DeprecationWarning: The sql_alchemy_conn option in [core] has been moved to the sql_alchemy_conn option in [database] - the old setting has been used, but please update your config.
[2025-07-26T11:37:40.427+0000] {task_command.py:426} INFO - Running <TaskInstance: insert_next_row_dag.insert_row manual__2025-07-26T11:37:39.668413+00:00 [running]> on host 2992d32593f0
[2025-07-26T11:37:40.478+0000] {taskinstance.py:2648} INFO - Exporting env vars: AIRFLOW_CTX_DAG_OWNER='***' AIRFLOW_CTX_DAG_ID='insert_next_row_dag' AIRFLOW_CTX_TASK_ID='insert_row' AIRFLOW_CTX_EXECUTION_DATE='2025-07-26T11:37:39.668413+00:00' AIRFLOW_CTX_TRY_NUMBER='1' AIRFLOW_CTX_DAG_RUN_ID='manual__2025-07-26T11:37:39.668413+00:00'
[2025-07-26T11:37:40.478+0000] {taskinstance.py:430} INFO - ::endgroup::
[2025-07-26T11:37:40.505+0000] {logging_mixin.py:188} WARNING - /opt/***/dags/simulate_realtime_insert.py:35 SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
[2025-07-26T11:37:40.505+0000] {logging_mixin.py:188} INFO - Row 0 to insert:
[2025-07-26T11:37:40.506+0000] {logging_mixin.py:188} INFO - | user_id                      | parent_asin   |   rating | timestamp                  | main_category   | title                                                                                                                              | description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | categories                                                    |   price | source   |
|:-----------------------------|:--------------|---------:|:---------------------------|:----------------|:-----------------------------------------------------------------------------------------------------------------------------------|:--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|:--------------------------------------------------------------|--------:|:---------|
| AF7RTZB4OYBFTYHE6YI23IBLYPJA | B01AW5V7PE    |        5 | 2022-06-15 00:09:28.917000 | Toys & Games    | Melissa & Doug Drawing Paper Pad (9 x 12 inches) - 50 Sheets, 3-Pack - Coloring Art Pads For Kids, Toddler Sketch Pads For Ages 3+ | {"Product Description", "This generously sized (9” x 12”) drawing pad provides a clean sheet for every creative whim. An essential art supply, our premium white bond paper is ideal for pencils, crayons, markers, chalk, poster paints, or watercolor artwork. The Melissa & Doug Drawing Paper Pad set is a 3-pack of pads that each have 50 sheets of premium heavy-weight bond paper. The large pages make the ideal canvas for little artists to express their creativity. We have designed this kids drawing pad with pages that are easy to remove from the pad with little tearing. This sketchpad for kids is made with heavy-duty paper, which makes it great for pencils, markers, and crayons. This Drawing Paper Pad makes an ideal gift for kids ages 3 and up. Add the Melissa & Doug Deluxe Wooden Standing Art Easel to round out the creative play experience. Each sheet measures 0.25" H x 12" W x 9" L, with 50 sheets in each pad. For more than 30 years, Melissa & Doug has created beautifully designed imagination- and creativity-sparking products that NBC News called “the gold standard in early childhood play.” Today, Melissa & Doug is proudly partnering with the American Academy of Pediatrics to foster early brain development and help children build important life skills through play.", "From the Manufacturer", "From classic wooden toys to crafts, pretend play, and games, Melissa & Doug products provide a launch pad to ignite imagination and a sense of wonder in all children so they can discover themselves, their passions, and their purpose.  Since the company’s founding more than 25 years ago, Melissa & Doug has consistently delivered innovative products that inspire open-ended thinking, encourage kids to see new possibilities, and offer Countless Ways to Play. It’s part of a bigger vision to Take Back Childhood. Because by giving children a true childhood with the space and freedom to explore their world, we give them a path to realizing their full potential!"} | {"Toys & Games", "Arts & Crafts", "Drawing & Writing Boards"} |   20.39 | val      |
[2025-07-26T11:37:41.632+0000] {taskinstance.py:441} INFO - ::group::Post task execution logs
[2025-07-26T11:37:41.632+0000] {taskinstance.py:2905} ERROR - Task failed with exception
Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1910, in _execute_context
    self.dialect.do_execute(
  File "/home/airflow/.local/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 736, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.UniqueViolation: duplicate key value violates unique constraint "new_reviews_pkey"
DETAIL:  Key (user_id, "timestamp", price)=(AF7RTZB4OYBFTYHE6YI23IBLYPJA, 2022-06-15 00:09:28.917, 20.39) already exists.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 465, in _execute_task
    result = _execute_callable(context=context, **execute_callable_kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 432, in _execute_callable
    return execute_callable(context=context, **execute_callable_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/baseoperator.py", line 401, in wrapper
    return func(self, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 235, in execute
    return_value = self.execute_callable()
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 252, in execute_callable
    return self.python_callable(*self.op_args, **self.op_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/dags/simulate_realtime_insert.py", line 43, in insert_one_row
    row_df.to_sql(
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/util/_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/core/generic.py", line 3008, in to_sql
    return sql.to_sql(
           ^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/io/sql.py", line 788, in to_sql
    return pandas_sql.to_sql(
           ^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/io/sql.py", line 1958, in to_sql
    total_inserted = sql_engine.insert_records(
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/io/sql.py", line 1507, in insert_records
    raise err
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/io/sql.py", line 1498, in insert_records
    return table.insert(chunksize=chunksize, method=method)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/io/sql.py", line 1059, in insert
    num_inserted = exec_insert(conn, keys, chunk_iter)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/io/sql.py", line 967, in _execute_insert_multi
    result = conn.execute(stmt)
             ^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1385, in execute
    return meth(self, multiparams, params, _EMPTY_EXECUTION_OPTS)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 334, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1577, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1953, in _execute_context
    self._handle_dbapi_exception(
  File "/home/airflow/.local/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2134, in _handle_dbapi_exception
    util.raise_(
  File "/home/airflow/.local/lib/python3.12/site-packages/sqlalchemy/util/compat.py", line 211, in raise_
    raise exception
  File "/home/airflow/.local/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1910, in _execute_context
    self.dialect.do_execute(
  File "/home/airflow/.local/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 736, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.IntegrityError: (psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "new_reviews_pkey"
DETAIL:  Key (user_id, "timestamp", price)=(AF7RTZB4OYBFTYHE6YI23IBLYPJA, 2022-06-15 00:09:28.917, 20.39) already exists.

[SQL: INSERT INTO public.new_reviews (user_id, parent_asin, rating, timestamp, main_category, title, description, categories, price, source) VALUES (%(user_id_m0)s, %(parent_asin_m0)s, %(rating_m0)s, %(timestamp_m0)s, %(main_category_m0)s, %(title_m0)s, %(description_m0)s, %(categories_m0)s, %(price_m0)s, %(source_m0)s)]
[parameters: {'user_id_m0': 'AF7RTZB4OYBFTYHE6YI23IBLYPJA', 'parent_asin_m0': 'B01AW5V7PE', 'rating_m0': 5.0, 'timestamp_m0': datetime.datetime(2022, 6, 15, 0, 9, 28, 917000), 'main_category_m0': 'Toys & Games', 'title_m0': 'Melissa & Doug Drawing Paper Pad (9 x 12 inches) - 50 Sheets, 3-Pack - Coloring Art Pads For Kids, Toddler Sketch Pads For Ages 3+', 'description_m0': '{"Product Description", "This generously sized (9” x 12”) drawing pad provides a clean sheet for every creative whim. An essential art supply, our pr ... (1677 characters truncated) ... cause by giving children a true childhood with the space and freedom to explore their world, we give them a path to realizing their full potential!"}', 'categories_m0': '{"Toys & Games", "Arts & Crafts", "Drawing & Writing Boards"}', 'price_m0': '20.39', 'source_m0': 'val'}]
(Background on this error at: https://sqlalche.me/e/14/gkpj)
[2025-07-26T11:37:41.639+0000] {taskinstance.py:1206} INFO - Marking task as FAILED. dag_id=insert_next_row_dag, task_id=insert_row, run_id=manual__2025-07-26T11:37:39.668413+00:00, execution_date=20250726T113739, start_date=20250726T113740, end_date=20250726T113741
[2025-07-26T11:37:41.644+0000] {standard_task_runner.py:110} ERROR - Failed to execute job 38 for task insert_row ((psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "new_reviews_pkey"
DETAIL:  Key (user_id, "timestamp", price)=(AF7RTZB4OYBFTYHE6YI23IBLYPJA, 2022-06-15 00:09:28.917, 20.39) already exists.

[SQL: INSERT INTO public.new_reviews (user_id, parent_asin, rating, timestamp, main_category, title, description, categories, price, source) VALUES (%(user_id_m0)s, %(parent_asin_m0)s, %(rating_m0)s, %(timestamp_m0)s, %(main_category_m0)s, %(title_m0)s, %(description_m0)s, %(categories_m0)s, %(price_m0)s, %(source_m0)s)]
[parameters: {'user_id_m0': 'AF7RTZB4OYBFTYHE6YI23IBLYPJA', 'parent_asin_m0': 'B01AW5V7PE', 'rating_m0': 5.0, 'timestamp_m0': datetime.datetime(2022, 6, 15, 0, 9, 28, 917000), 'main_category_m0': 'Toys & Games', 'title_m0': 'Melissa & Doug Drawing Paper Pad (9 x 12 inches) - 50 Sheets, 3-Pack - Coloring Art Pads For Kids, Toddler Sketch Pads For Ages 3+', 'description_m0': '{"Product Description", "This generously sized (9” x 12”) drawing pad provides a clean sheet for every creative whim. An essential art supply, our pr ... (1677 characters truncated) ... cause by giving children a true childhood with the space and freedom to explore their world, we give them a path to realizing their full potential!"}', 'categories_m0': '{"Toys & Games", "Arts & Crafts", "Drawing & Writing Boards"}', 'price_m0': '20.39', 'source_m0': 'val'}]
(Background on this error at: https://sqlalche.me/e/14/gkpj); 25001)
[2025-07-26T11:37:41.685+0000] {local_task_job_runner.py:243} INFO - Task exited with return code 1
[2025-07-26T11:37:41.692+0000] {taskinstance.py:3503} INFO - 0 downstream tasks scheduled from follow-on schedule check
[2025-07-26T11:37:41.693+0000] {local_task_job_runner.py:222} INFO - ::endgroup::
